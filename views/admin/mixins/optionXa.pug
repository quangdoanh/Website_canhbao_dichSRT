//- mixin optionXa(listXaTheoHuyen)
//-   //- Render tất cả xã, kèm data-huyen để lọc
//-   each item in listXaTheoHuyen
//-     each xa in item.dsXa
//-       option(value=xa.ma_xa data-huyen=item.huyen )= xa.ten_xa
mixin optionXa(listXaTheoHuyen, selectedXa)
  each item in listXaTheoHuyen
    each xa in item.dsXa
      if selectedXa && selectedXa == xa.ma_xa
        option(value=xa.ma_xa data-huyen=item.huyen selected)= xa.ten_xa
      else
        option(value=xa.ma_xa data-huyen=item.huyen)= xa.ten_xa 
    
  //- Script lọc xã theo huyện
  script.
    const tinhSelect = document.querySelector("select.tinh");
    const huyenSelect = document.querySelector("select.huyen");
    const xaSelect = document.querySelector("select.xa");

    function filterHuyenByTinh(ma_tinh, isInit = false) {
      const options = huyenSelect.querySelectorAll("option[data-tinh]");
      let valid = false;
      options.forEach(opt => {
        if (!ma_tinh || opt.getAttribute("data-tinh") === ma_tinh) {
          opt.hidden = false;
          if (opt.value === huyenSelect.value) valid = true;
        } else {
          opt.hidden = true;
          opt.selected = false;
        }
      });
      if (!valid) huyenSelect.selectedIndex = 0;
      if (!isInit) {
        xaSelect.selectedIndex = 0;
        filterXaByHuyen("");
      }
    }

    function filterXaByHuyen(ma_huyen, isInit = false) {
      const options = xaSelect.querySelectorAll("option[data-huyen]");
      let valid = false;
      options.forEach(opt => {
        if (!ma_huyen || opt.getAttribute("data-huyen") === ma_huyen) {
          opt.hidden = false;
          if (opt.value === xaSelect.value) valid = true;
        } else {
          opt.hidden = true;
          opt.selected = false;
        }
      });
      if (!valid) xaSelect.selectedIndex = 0;
    }

    tinhSelect.addEventListener("change", e => {
      filterHuyenByTinh(e.target.value, false);
    });

    huyenSelect.addEventListener("change", e => {
      filterXaByHuyen(e.target.value, false);
    });

    // init giữ selected
    if (tinhSelect.value) filterHuyenByTinh(tinhSelect.value, true);
    if (huyenSelect.value) filterXaByHuyen(huyenSelect.value, true);




    //- let dataDetail = !{JSON.stringify(dataDetail) || 'null'};

    //- if (dataDetail && dataDetail.ma_xa ) {
    //-   // Khi focus vào tỉnh → chỉ giữ lại tỉnh chứa xã đó
    //-   tinhSelect.addEventListener("focus", () => {
    //-     [...tinhSelect.options].forEach(opt => {
    //-       opt.hidden = !(opt.value === "" || opt.value === String(dataDetail.tinh_from_xa));
    //-     });
    //-   });

    //-   // Khi focus vào huyện → chỉ giữ lại huyện chứa xã đó
    //-   huyenSelect.addEventListener("focus", () => {
    //-     [...huyenSelect.options].forEach(opt => {
    //-       opt.hidden = !(opt.value === "" || opt.value === String(dataDetail.huyen_from_xa));
    //-     });
    //-   });

    //-   // Khi focus vào xã → chỉ giữ lại xã đã chọn
    //-   xaSelect.addEventListener("focus", () => {
    //-     [...xaSelect.options].forEach(opt => {
    //-       opt.hidden = !(opt.value === "" || opt.value === String(dataDetail.ma_xa));
    //-     });
    //-   });
    //- }
