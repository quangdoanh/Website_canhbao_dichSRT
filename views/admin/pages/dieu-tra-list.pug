extends ../layouts/default.pug
include ../mixins/optionTinh.pug
include ../mixins/optionHuyen.pug
include ../mixins/optionXa.pug
block main
  h1.box-title Danh sách điều tra

  //- Section 4: Bộ lọc
  .section-4
    .inner-wrap
      .inner-item.inner-label
        <i class="fa-solid fa-filter"></i> Bộ lọc
        .inner-group
          select(id="tinh" name="tinh" class="tinh" required filter-Ma_tinh)
            option(value="") Tỉnh
            +optionTinh(ListTinh)
        .inner-group
          select(id="huyen" name="huyen" class="huyen" filter-Ma_huyen)
            option(value="") Huyện
            +optionHuyen(ListHuyen)
        .inner-group
          select(id="xa" name="xa" class="xa" filter-Ma_xa)
            option(value="") Xã
            +optionXa(ListXaTheoHuyen)  
      .inner-item.inner-date
        input(type="date" filter-start-date value="2025-09-01")
        span - 
        input(type="date" filter-end-date value="2025-09-22")        
      .inner-item.inner-reset(filter-reset)
        <i class="fa-solid fa-rotate-left"></i> Xóa bộ lọc

  //- Section 5: Hành động & tìm kiếm
  .section-5
    .inner-wrap
      .inner-change-status(delete-multi data-api=`/${pathAdmin}/dieutra/deleteMulti`)
        .inner-item
          select
            option(value="") -- Hành động --
            option(value="delete") Xóa
            
        .inner-item
          button Áp dụng
      //- .inner-search
      //-   i(class="fa-solid fa-magnifying-glass")
      //-   input(type="text" placeholder="Tìm kiếm" search)
      .inner-button-create
          a(href=`/${pathAdmin}/dieutra/create`) + Tạo mới

  //- //- Section 6: Bảng danh sách
  .section-6
    .table-2
      table
        thead
          tr
            th.inner-center
              input(type="checkbox" class="inner-check" check-all)
            th.inner-center Địa chỉ
            th.inner-center Tỉnh
            th.inner-center Huyện
            th.inner-center Xã
            th Số sâu non
            th Số cây
            th Loại cây
            th Đường kính TB
            th Tiểu khu 
            th Khoảnh 
            th Lô
            th Ngày điều tra
            th Trạng thái
            th Hành động
        tbody
        if dieutraList.length 
          each item in dieutraList
            tr
              td.inner-center
                input(type="checkbox" class="inner-check" check-item = item.id)
              td.inner-center= item.dia_chi_cu_the || "Không xác định"
              td.inner-center= item.ten_tinh || "Không xác định"
              td.inner-center= item.ten_huyen || "Không xác định"
              td.inner-center= item.ten_xa || "Không xác định"
              td= item.so_sau_non || ""
              td= item.so_cay || ""
              td= item.loai_cay === "thongmavi" ? "Thông Mã Vĩ" : item.loai_cay === "thongnhua" ? "Thông Nhựa" : ""
              td= item.duong_kinh_tb || ""
              td=item.tk || ""
              td=item.khoanh || ""
              td=item.lo || ""
              td= item.dtra_dateFormat || ""
              td   
                if item.status == 1
                  .badge.badge-red  Đang xử lý
                else 
                  .badge.badge-green Đã xử lý
              td
                .inner-buttons
                  a.inner-edit(href=`/${pathAdmin}/dieutra/edit/${item.id}`)
                    i(class="fa-regular fa-pen-to-square")
                  button.inner-delete(button-delete data-api=`/${pathAdmin}/dieutra/delete/${item.id}`)
                    i(class="fa-regular fa-trash-can")
        else
          tr
            td(colspan=9 style="text-align:center") Không có dữ liệu

  //- Section 7: Pagination
  .section-7
    - const start = (pagination.page - 1) * limit + 1;
    - const end = Math.min(pagination.page * limit, pagination.totalRecords);
    span.inner-label Hiển thị #{start} - #{end} của #{pagination.totalRecords}

    select.inner-pagination(pagination name="page")
      each val in [...Array(pagination.totalPages).keys()]
        - const pageNum = val + 1;
        option(value=pageNum selected=(pageNum === pagination.page)) Trang #{pageNum}


